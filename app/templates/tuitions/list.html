{% extends "base.html" %}

{% block title %}Financial - Student Management{% endblock %}

{% block content %}
<div class="row mb-4 border-bottom border-white">
    <div class="col-md-6 p-2">
        <h1 class="text-white">Tuitions</h1>
    </div>
    <div class="col-md-6 text-end p-2">
        <a href="#" class="btn btn-primary btn-hover">+ Add New Tuition</a>
    </div>
</div>


<!-- Search Form -->
<div class="card mb-4 btn-hover">
    <div class="card-body">
        <form method="POST" action="{{ url_for('tuitions.search') }}">
            <div class="row">
                <div class="col-md-2">
                    <input type="text" name="fee_id" class="form-control" placeholder="Fee ID">
                </div>
                <div class="col-md-2">
                    <input type="text" name="name" class="form-control" placeholder="Full Name">
                </div>
                <div class="col-md-2">
                    <select class="form-select" aria-label="Default select example" name="semester">
                        <option value="" selected>-- Semester --</option>
                        <option value="Spring">Spring</option>
                        <option value="Partially Paid">Summer</option>
                        <option value="Fall">Fall</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" aria-label="Default select example" name="status">
                        <option value="" selected>-- Status --</option>
                        <option value="Unpaid">Unpaid</option>
                        <option value="Partially Paid">Partially Paid</option>
                        <option value="Fully Paid">Fully Paid</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-info w-100 btn-hover text-white">Search</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Students Table -->
<div class="table-container border border-primary rounded-4">
    <table class="table table-striped table-hover text-center">
        <thead class="table-primary sticky-header">
            <tr>
                <th>#</th>
                <th>Fee Code</th>
                <th>Student</th>
                <th>Student ID</th>
                <th>Semester</th>
                <th>Academic Year</th>
                <th>Total Amount</th>
                <th>Amount Paid</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody class="table-scroll">
            {% if tuitions|length == 0 %}
            <tr>
                <td colspan="12" class="text-center text-muted">No tuition found</td>
            </tr>
            {% endif %}
            {% for tuition in tuitions %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ tuition.fee_id }}</td>
                <td>{{ tuition.full_name }}</td>
                <td>{{ tuition.student_id }}</td>
                <td>{{ tuition.semester }}</td>
                <td>{{ tuition.academic_year }}</td>
                <td>{{ tuition.total_amount }}</td>
                <td>{{ tuition.amount_paid }}</td>
                <td>{{ tuition.payment_status }}</td>
                <td>
                    <div class="dropdown">
                        <a class="btn btn-outline-primary dropdown-toggle rounded-5" href="#" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            More
                        </a>

                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item btn btn-primary"
                                    href="{{ url_for('tuitions.view', fee_id=tuition.fee_id) }}" type="button">View</a>
                            </li>
                            <li><a class="dropdown-item" href="#">Edit</a></li>
                            <li><a class="dropdown-item text-danger" type="button"
                                    onclick="deleteTuition('{{ tuition.fee_id }}')">Delete</a></li>
                        </ul>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Model -->
<!-- <div class="modal fade" id="ViewModal" tabindex="-1" aria-labelledby="ViewModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content text-white" style="background: rgb(23, 28, 36);">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="ViewModal">Payment Information</h1>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="recipient-name" class="col-form-label">Recipient:</label>
                <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div> -->

<!-- Script modal -->
<!-- <script>
    const ViewModal = document.getElementById('ViewModal')
    if (ViewModal) {
        ViewModal.addEventListener('show.bs.modal', async event => {

            const button = event.relatedTarget;
            const fee_id = button.getAttribute('data-bs-feeid');

            const modalTitle = ViewModal.querySelector('.modal-title');
            const modalBody = ViewModal.querySelector('.modal-body');

            modalTitle.textContent = `Thông tin Fee ID: ${fee_id}`;
            modalBody.innerHTML = "<p>Đang tải dữ liệu...</p>";

            try {
                const response = await fetch(`/tuitions/payments/${fee_id}`);
                const data = await response.json();

                modalBody.innerHTML = `
                    <div><strong>Payment ID:</strong> ${data.payment_id}</div>
                    <div><strong>Payment Date:</strong> ${data.payment_date}</div>
                    <div><strong>Total Amount:</strong> ${data.amount}</div>
                    <div><strong>Payment Method:</strong> ${data.payment_method}</div>
                    <div><strong>Transaction Code:</strong> ${data.transaction_code}</div>
                    <div><strong>Collected By:</strong> ${data.collected_by}</div>
                    <div><strong>Remarks:</strong> ${data.remarks}</div>
                `;
            } catch (error) {
                modalBody.innerHTML = `<p class="text-secondary">No data.</p>`;
            }
        })
    }
</script> -->


<!-- Script delete -->
<script>
    function deleteTuition(id) {
        if (confirm('Are you sure you want to delete this tuition?')) {
            fetch(`/tuitions/delete/${id}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.href = '{{ url_for("tuitions.list") }}';
                    } else {
                        alert(data.message);
                    }
                });
        }
    }
</script>

{% endblock %}